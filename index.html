```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>美食性格小測驗｜三頁式 Demo</title>
  <style>
    :root { --maxw: 880px; --gap: 14px; --brand: #4f46e5; }
    * { box-sizing: border-box; }
    html, body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Noto Sans TC, Arial; color: #111; height: 100%; }
    .bg { position: fixed; inset: 0; z-index: 0; }
    .bg::before { content: ""; position: absolute; inset: 0;
      background: url("https://drive.google.com/thumbnail?id=1w9IWyghLE1G0gYXiW5DQH1zFBoYqu8Ot&sz=w2400") no-repeat center center;
      background-size: cover;
    }
    .bg::after { content: ""; position: absolute; inset: 0; background: rgba(255,255,255,.25); }
    .wrap { position: relative; z-index: 1; }

    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    .header { display: flex; align-items: center; justify-content: space-between; padding: 16px 0; }
    .brand { font-weight: 700; letter-spacing: .5px; }

    .progress { height: 8px; background: #e9e9f7; border-radius: 999px; overflow: hidden; }
    .progress > span { display: block; height: 100%; background: var(--brand); width: 0%; transition: width .35s ease; }
    .progress-text { font-size: 12px; color: #666; margin-top: 6px; text-align: right; }

    .stage { display: none; }
    .stage.active { display: block; animation: fadeIn .38s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: #fff; border-radius: 16px; box-shadow: 0 12px 28px rgba(0,0,0,.06); padding: 20px; }
    .hero { text-align: center; padding: 24px; }
    .hero h1 { margin: 0 0 8px; font-size: 28px; }
    .hero p { margin: 0 0 16px; color: #555; }
    .card.hero { background: rgba(255, 247, 237, 0.92); border: 1px solid #F5E6CC; }

    .grid { display: grid; gap: var(--gap); }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }

    .qcard { border: 1px solid #F5E6CC; border-radius: 14px; padding: 14px; background: rgba(255, 247, 237, 0.92); box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    .qcard h3 { margin: 0 0 10px; font-size: 16px; }
    .opts { display: grid; gap: 8px; }
    label.option { display: flex; align-items: center; gap: 10px; background: #fff; border: 1px solid #e9e9f5; padding: 10px 12px; border-radius: 10px; cursor: pointer; }
    label.option:hover { border-color: #FDE68A; background: #FFF7ED; }
    input[type="radio"]{ transform: scale(1.1); }

    .actions { display: flex; gap: 10px; justify-content: space-between; margin-top: 16px; flex-wrap: wrap; }
    .right { margin-left: auto; display: flex; gap: 10px; }

    button { appearance: none; border: 0; padding: 10px 16px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: var(--brand); color: #fff; }
.btn-instagram {
  border-radius: 9999px;  /* 膠囊圓角 */
  padding: 14px 28px;    /* 更大更舒適 */
  background: linear-gradient(135deg, #ff9a9e, #fad0c4); /* 粉橘漸層 */
  color: #fff !important;
  font-size: 1.1rem;
  font-weight: bold;
  text-align: center;
  text-decoration: none;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
  display: inline-block;
}

.btn-instagram:hover {
  background: linear-gradient(135deg, #fad0c4, #ff9a9e); /* hover 時漸層反轉 */
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
}

    .btn-ghost { background: #fff; border: 1px solid #ddd; }
    .btn-flat  { background: transparent; color: var(--brand); }

    .status { margin-top: 10px; color: #d00; font-size: 13px; }

    .result-hero { background: linear-gradient(135deg, #eef2ff, #fff); border: 1px solid #e8eaff; border-radius: 16px; padding: 16px; }
    .result-hero h2 { margin: 6px 0; font-size: 24px; }
    .result-hero .muted { color: #666; font-size: 13px; }
    .result-card { border-radius: 16px; box-shadow: 0 12px 28px rgba(0,0,0,.12); position: relative; overflow: hidden; }
    .result-a { background: rgba(173, 216, 230, 0.9); border: 1px solid rgba(59,130,246,.25);} 
    .result-b { background: rgba(144, 238, 144, 0.9); border: 1px solid rgba(34,197,94,.25);} 
    .result-c { background: rgba(255, 255, 224, 0.92); border: 1px solid rgba(250,204,21,.3);} 
    .result-d { background: rgba(255, 182, 193, 0.92); border: 1px solid rgba(244,63,94,.25);} 
    .result-card::after { position: absolute; right: -4px; top: -6px; font-size: 96px; opacity: .28; line-height: 1; transform: rotate(10deg); }
    .result-a::after { content: "🍧"; }
    .result-b::after { content: "🥗"; }
    .result-c::after { content: "🍰"; }
    .result-d::after { content: "🌶️"; }
    .result-a { border-style: solid; }
    .result-b { border-style: dashed; }
    .result-c { border-style: dotted; }
    .result-d { border-style: solid; border-width: 2px; } 
    .result-hero h2 { margin: 6px 0; font-size: 24px; }
    .result-hero .muted { color: #666; font-size: 13px; }

    .hidden { display: none; }
    #resultCode { display: none; }
    .promo { margin-top: 14px; background: rgba(255,255,255,.6); border: 1px dashed #e5d3b5; border-radius: 12px; padding: 12px; }
    .promo-text { margin: 0 0 10px; font-weight: 600; color: #6b4e16; }
    .promo-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .promo-btn { text-decoration: none; display: inline-block; }
    .promo-qr { width: 120px; height: 120px; border-radius: 8px; background: #fff; padding: 6px; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .promo-note { margin-top: 6px; font-size: 12px; color: #7a6a4a; }
/* 背景與其偽元素不吃事件，避免偶發擋住按鈕 */
.bg, .bg::before, .bg::after { pointer-events: none; }
/* 結尾區塊的排版與樣式強化 */
.promo-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 720px) { .promo-row { grid-template-columns: 1fr 1fr; } }

.promo-item { display: flex; flex-direction: column; align-items: center; gap: 8px; }

.promo-caption {
  font-size: 12px; color: #7a6a4a;
  background: rgba(255,255,255,.7);
  padding: 4px 8px; border-radius: 8px;
}

/* QR 改為可點擊的小卡片樣式（與膠囊按鈕做出區隔） */
.promo-qr-link {
  display: inline-block;
  border: 1px dashed #e5d3b5;
  background: #fff;
  border-radius: 12px;
  padding: 6px;
  box-shadow: 0 2px 10px rgba(0,0,0,.06);
  transition: transform .2s ease, box-shadow .2s ease;
}
.promo-qr-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,.12);
}

/* QR 稍微放大，畫面更平衡（覆蓋原 120px） */
.promo-qr { width: 140px; height: 140px; }
/* 結果描述排版（字多時更好讀） */
#resultDesc {
  font-size: 16px;
  line-height: 1.9;
}
@media (min-width: 720px) {
  #resultDesc { font-size: 17px; }
}

  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="wrap">
    <div class="header">
      <div class="brand">🍽 美食性格小測驗</div>
      <div id="headerStep" class="progress-text">準備開始</div>
    </div>

    <div class="progress"><span id="progressBar"></span></div>
    <div class="progress-text" id="progressText"></div>

    <section class="stage active" id="stage0">
      <div class="card hero">
        <h1>找出你的美食性格</h1>
        <p>8 題 × 三選一，約 30 秒完成。來看看你是甚麼性格的人吧!!</p>
        <button class="btn-primary" id="startBtn">開始測驗</button>
      </div>
    </section>

    <section class="stage" id="stage1">
      <div class="grid">
        <div class="qcard">
          <h3>1. 天氣熱會選擇…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q1" value="a"> a. 挫冰</label>
            <label class="option"><input type="radio" name="q1" value="b"> b. 霜淇淋</label>
            <label class="option"><input type="radio" name="q1" value="c"> c. 涼茶</label>
          </div>
        </div>
        <div class="qcard">
          <h3>2. 最無法接受下列何者…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q2" value="a"> a. 蝦米霜淇淋</label>
            <label class="option"><input type="radio" name="q2" value="b"> b. 香菜雪糕</label>
            <label class="option"><input type="radio" name="q2" value="c"> c. 豬血糕比薩</label>
          </div>
        </div>
        <div class="qcard">
          <h3>3. 主食更喜歡吃…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q3" value="a"> a. 飯</label>
            <label class="option"><input type="radio" name="q3" value="b"> b. 麵</label>
            <label class="option"><input type="radio" name="q3" value="c"> c. 麵包類</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>返回</button>
        <div class="right">
          <button class="btn-primary" data-next>下一頁</button>
        </div>
      </div>
      <div class="status" id="status1"></div>
    </section>

    <section class="stage" id="stage2">
      <div class="grid">
        <div class="qcard">
          <h3>4. 拿到餐盒最先吃…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q4" value="a"> a. 紅豆麵包</label>
            <label class="option"><input type="radio" name="q4" value="b"> b. 菠蘿麵包</label>
            <label class="option"><input type="radio" name="q4" value="c"> c. 蛋糕捲</label>
          </div>
        </div>
        <div class="qcard">
          <h3>5. 喜歡哪種料理</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q5" value="a"> a. 日式</label>
            <label class="option"><input type="radio" name="q5" value="b"> b. 韓式</label>
            <label class="option"><input type="radio" name="q5" value="c"> c. 台式</label>
          </div>
        </div>
        <div class="qcard">
          <h3>6. 喜歡的食物會…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q6" value="a"> a. 第一口先吃</label>
            <label class="option"><input type="radio" name="q6" value="b"> b. 留到最後再吃</label>
            <label class="option"><input type="radio" name="q6" value="c"> c. 想吃就吃不會管太多</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>返回</button>
        <div class="right">
          <button class="btn-primary" data-next>下一頁</button>
        </div>
      </div>
      <div class="status" id="status2"></div>
    </section>

    <section class="stage" id="stage3">
      <div class="grid">
        <div class="qcard">
          <h3>7. 吃咖哩會…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q7" value="a"> a. 一口飯一口醬</label>
            <label class="option"><input type="radio" name="q7" value="b"> b. 暴力拌勻</label>
            <label class="option"><input type="radio" name="q7" value="c"> c. 先吃完醬再吃飯</label>
          </div>
        </div>
        <div class="qcard">
          <h3>8. 喝飲料會點…</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q8" value="a"> a. 微糖</label>
            <label class="option"><input type="radio" name="q8" value="b"> b. 半糖</label>
            <label class="option"><input type="radio" name="q8" value="c"> c. 全糖</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>返回</button>
        <div class="right">
          <button class="btn-primary" id="submitBtn">提交答案</button>
        </div>
      </div>
      <div class="status" id="status3"></div>
    </section>

    <section class="stage" id="stageResult">
      <div class="card result-hero result-card result-a" id="resultCard">
        <div class="muted" id="resultCode">結果代碼：—</div>
        <h2 id="resultTitle">你的美食性格是 —— </h2>
        <p id="resultDesc" style="margin:8px 0 0;">將在這裡顯示你的描述。</p>
       <div class="promo">
  <p class="promo-text">想了解更多美食資訊、加入我們社團 👉</p>

  <div class="promo-row">
    <!-- A. 膠囊按鈕（維持你的 IG 連結） -->
    <div class="promo-item">
      <a class="btn-primary promo-btn btn-instagram"
         href="https://www.instagram.com/ntnuckclub_?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="
         target="_blank" rel="noopener">
        師大美食社
      </a>
      <div class="promo-caption">社團IG連結</div>
    </div>

    <!-- B. QR 卡片：改為連到迎新表單 -->
<div class="promo-item">
  <a class="promo-qr-link"
     href="https://docs.google.com/forms/d/e/1FAIpQLSeSLpOJUDOHCWa3yhksq1W7AsSUxH_u8TckBC5CJKBM_H0v0w/viewform?usp=header"
     target="_blank" rel="noopener" aria-label="前往迎新報名表單（Google 表單）">
    <img class="promo-qr" id="promoQR" alt="迎新表單 QR Code"
         src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https%3A%2F%2Fdocs.google.com%2Fforms%2Fd%2Fe%2F1FAIpQLSeSLpOJUDOHCWa3yhksq1W7AsSUxH_u8TckBC5CJKBM_H0v0w%2Fviewform%3Fusp%3Dheader" />
  </a>
  <div class="promo-caption">9/9(二)迎新茶會表單</div>
</div>
  </div>

  <div class="promo-note">點擊即可開啟社團 IG，歡迎追蹤與私訊詢問活動！</div>
</div>

          <div class="promo-note">迎新茶會9/9(二)歡迎大家加入我們一起玩٩(´ᗜ`*)୨</div>
        </div>
        <div class="actions" style="margin-top:14px;">
          <button class="btn-ghost" id="restartBtn">再測一次</button>
        </div>
      </div>
    </section>

  </div>

  <script>
    const OPTION_SCORE = { a: 0, b: 1, c: 2 };
    const BUCKETS = [
      { max: 4,  code: 'A' },
      { max: 6, code: 'B' },
      { max: 8, code: 'C' },
      { max: 25, code: 'D' },
    ];
   const RESULT_TEXTS = {
  A: {
    title: 'A 型：香草冰淇淋小天使',
    desc: '偏愛純淨與清爽的口味，行事俐落重效率；待人溫柔又可靠，願意主動協助與傾聽，像淡淡香草帶來安定與安心感。'
  },
  B: {
    title: 'B 型：沙拉番茄小工匠',
    desc: '講究酸甜與口感的平衡，喜歡層次清楚的搭配；做事耐心細緻，重視協作與秩序，願意調和不同意見，讓結果恰到好處。'
  },
  C: {
    title: 'C 型：花茶蛋糕小公主',
    desc: '熱愛儀式感與細節，美感敏銳，偏好細緻優雅的風味；擅於營造氛圍與節奏，把日常打理成風景，讓人感到放鬆與愉悅。'
  },
  D: {
    title: 'D 型：火辣辣椒小冒險家',
    desc: '勇於嘗鮮不設限，面對新奇總是眼睛發亮；行動力強且富創意，樂於揪團分享，總能把熱辣能量化作故事與回憶。'
  }
};

// === 後端紀錄設定（Google Apps Script） ===
const ENABLE_LOGGING = true;
const LOG_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzEsbc1uIDRIEtmFfjH6_AP8fpNwW0KmpcBmnpjGuW3aR48CnYPovjUFCrTDalCilQ/exec';

function sendLog(payload){
  if (!ENABLE_LOGGING || !LOG_ENDPOINT) return;
  try {
    fetch(LOG_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      mode: 'no-cors',      // 不讀回應，最穩定
      keepalive: true
    }).catch(()=>{});
  } catch(e){}
}

    

    const stages = ['stage0', 'stage1', 'stage2', 'stage3', 'stageResult'];
    let current = 0;

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function showStage(idx) {
      stages.forEach((id,i) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.toggle('active', i === idx);
      });
      current = idx;
      updateProgress();
      $$('.status').forEach(s => s.textContent = '');
    }

    function updateProgress(){
      const pb = $('#progressBar');
      const pt = $('#progressText');
      const hs = $('#headerStep');
      let step = 0, total = 3;
      if (current>=1 && current<=3) step = current;
      const percent = Math.round(step/total*100);
      pb.style.width = percent + '%';
      pt.textContent = step>0 ? `第 ${step} / ${total} 頁（${percent}%）` : '';
      hs.textContent = step>0 ? `第 ${step} / ${total} 頁` : (current===4? '完成' : '準備開始');
    }

    function validatePage(idx){
      const reqByStage = {
        1: ['q1','q2','q3'],
        2: ['q4','q5','q6'],
        3: ['q7','q8'],
      };
      const ids = reqByStage[idx] || [];
      let missing = [];
      ids.forEach(name => {
        const checked = $$(`input[name="${name}"]:checked`).length>0;
        if (!checked) missing.push(name);
      });
      if (missing.length){
        const statusEl = document.getElementById('status'+idx);
        const map = {q1:'第1題',q2:'第2題',q3:'第3題',q4:'第4題',q5:'第5題',q6:'第6題',q7:'第7題',q8:'第8題'};
        statusEl.textContent = '請先作答：' + missing.map(k=>map[k]).join('、');
        return false;
      }
      return true;
    }

    function computeResult(){
      let total = 0; const answers = {};
      for (let i=1;i<=8;i++){
        const el = $(`input[name="q${i}"]:checked`);
        if (!el) return { error: `第 ${i} 題尚未作答` };
        const v = el.value; answers['q'+i] = v;
        total += OPTION_SCORE[v] ?? 0;
      }
      const bucket = BUCKETS.find(b => total <= b.max) || BUCKETS[BUCKETS.length-1];
      const def = RESULT_TEXTS[bucket.code] || { title:'未定義', desc:'請檢查規則設定' };
      return { total, code: bucket.code, title: def.title, desc: def.desc, answers };
    }

    function renderResult(r){
      const codeMap = {A:'result-a', B:'result-b', C:'result-c', D:'result-d'};
      document.getElementById('resultCode').textContent = `結果代碼：${r.code}（總分 ${r.total}）`;
      document.getElementById('resultTitle').textContent = r.title;
      document.getElementById('resultDesc').textContent = r.desc;
      const box = document.getElementById('resultCard');
      ['result-a','result-b','result-c','result-d'].forEach(c=>box.classList.remove(c));
      if (codeMap[r.code]) box.classList.add(codeMap[r.code]);
    }

    document.getElementById('startBtn')?.addEventListener('click', () => showStage(1));

$$('[data-back]').forEach(btn => btn?.addEventListener('click', () => {
  if (current>1) showStage(current-1); else showStage(0);
}));

$$('[data-next]').forEach(btn => btn?.addEventListener('click', () => {
  if (!validatePage(current)) return;
  if (current<3) showStage(current+1);
}));


    document.getElementById('submitBtn').addEventListener('click', () => {
      if (!validatePage(3)) return;
      const r = computeResult();
      if (r.error){ document.getElementById('status3').textContent = r.error; return; }
      renderResult(r);
      sendLog({
  timestamp: new Date().toISOString(),
  answers: r.answers,
  total: r.total,
  code: r.code,
  title: r.title,
  desc: r.desc,
  userAgent: navigator.userAgent,
  referrer: document.referrer || ''
});

      showStage(4);
    });

    document.getElementById('restartBtn').addEventListener('click', () => {
      for (let i=1;i<=8;i++){ const el = $$(`input[name="q${i}"]`); el.forEach(x=>x.checked=false); }
      showStage(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    updateProgress();
  </script>
</body>
</html>
```