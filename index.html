```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¾é£Ÿæ€§æ ¼å°æ¸¬é©—ï½œä¸‰é å¼ Demo</title>
  <style>
    :root { --maxw: 880px; --gap: 14px; --brand: #4f46e5; }
    * { box-sizing: border-box; }
    html, body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Noto Sans TC, Arial; color: #111; height: 100%; }
    .bg { position: fixed; inset: 0; z-index: 0; }
    .bg::before { content: ""; position: absolute; inset: 0;
      background: url("https://drive.google.com/thumbnail?id=1w9IWyghLE1G0gYXiW5DQH1zFBoYqu8Ot&sz=w2400") no-repeat center center;
      background-size: cover;
    }
    .bg::after { content: ""; position: absolute; inset: 0; background: rgba(255,255,255,.25); }
    .wrap { position: relative; z-index: 1; }

    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    .header { display: flex; align-items: center; justify-content: space-between; padding: 16px 0; }
    .brand { font-weight: 700; letter-spacing: .5px; }

    .progress { height: 8px; background: #e9e9f7; border-radius: 999px; overflow: hidden; }
    .progress > span { display: block; height: 100%; background: var(--brand); width: 0%; transition: width .35s ease; }
    .progress-text { font-size: 12px; color: #666; margin-top: 6px; text-align: right; }

    .stage { display: none; }
    .stage.active { display: block; animation: fadeIn .38s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: #fff; border-radius: 16px; box-shadow: 0 12px 28px rgba(0,0,0,.06); padding: 20px; }
    .hero { text-align: center; padding: 24px; }
    .hero h1 { margin: 0 0 8px; font-size: 28px; }
    .hero p { margin: 0 0 16px; color: #555; }
    .card.hero { background: rgba(255, 247, 237, 0.92); border: 1px solid #F5E6CC; }

    .grid { display: grid; gap: var(--gap); }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }

    .qcard { border: 1px solid #F5E6CC; border-radius: 14px; padding: 14px; background: rgba(255, 247, 237, 0.92); box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    .qcard h3 { margin: 0 0 10px; font-size: 16px; }
    .opts { display: grid; gap: 8px; }
    label.option { display: flex; align-items: center; gap: 10px; background: #fff; border: 1px solid #e9e9f5; padding: 10px 12px; border-radius: 10px; cursor: pointer; }
    label.option:hover { border-color: #FDE68A; background: #FFF7ED; }
    input[type="radio"]{ transform: scale(1.1); }

    .actions { display: flex; gap: 10px; justify-content: space-between; margin-top: 16px; flex-wrap: wrap; }
    .right { margin-left: auto; display: flex; gap: 10px; }

    button { appearance: none; border: 0; padding: 10px 16px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: var(--brand); color: #fff; }
.btn-instagram {
  border-radius: 9999px;  /* è† å›Šåœ“è§’ */
  padding: 14px 28px;    /* æ›´å¤§æ›´èˆ’é© */
  background: linear-gradient(135deg, #ff9a9e, #fad0c4); /* ç²‰æ©˜æ¼¸å±¤ */
  color: #fff !important;
  font-size: 1.1rem;
  font-weight: bold;
  text-align: center;
  text-decoration: none;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
  display: inline-block;
}

.btn-instagram:hover {
  background: linear-gradient(135deg, #fad0c4, #ff9a9e); /* hover æ™‚æ¼¸å±¤åè½‰ */
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
}

    .btn-ghost { background: #fff; border: 1px solid #ddd; }
    .btn-flat  { background: transparent; color: var(--brand); }

    .status { margin-top: 10px; color: #d00; font-size: 13px; }

    .result-hero { background: linear-gradient(135deg, #eef2ff, #fff); border: 1px solid #e8eaff; border-radius: 16px; padding: 16px; }
    .result-hero h2 { margin: 6px 0; font-size: 24px; }
    .result-hero .muted { color: #666; font-size: 13px; }
    .result-card { border-radius: 16px; box-shadow: 0 12px 28px rgba(0,0,0,.12); position: relative; overflow: hidden; }
    .result-a { background: rgba(173, 216, 230, 0.9); border: 1px solid rgba(59,130,246,.25);} 
    .result-b { background: rgba(144, 238, 144, 0.9); border: 1px solid rgba(34,197,94,.25);} 
    .result-c { background: rgba(255, 255, 224, 0.92); border: 1px solid rgba(250,204,21,.3);} 
    .result-d { background: rgba(255, 182, 193, 0.92); border: 1px solid rgba(244,63,94,.25);} 
    .result-card::after { position: absolute; right: -4px; top: -6px; font-size: 96px; opacity: .28; line-height: 1; transform: rotate(10deg); }
    .result-a::after { content: "ğŸ§"; }
    .result-b::after { content: "ğŸ¥—"; }
    .result-c::after { content: "ğŸ°"; }
    .result-d::after { content: "ğŸŒ¶ï¸"; }
    .result-a { border-style: solid; }
    .result-b { border-style: dashed; }
    .result-c { border-style: dotted; }
    .result-d { border-style: solid; border-width: 2px; } 
    .result-hero h2 { margin: 6px 0; font-size: 24px; }
    .result-hero .muted { color: #666; font-size: 13px; }

    .hidden { display: none; }
    #resultCode { display: none; }
    .promo { margin-top: 14px; background: rgba(255,255,255,.6); border: 1px dashed #e5d3b5; border-radius: 12px; padding: 12px; }
    .promo-text { margin: 0 0 10px; font-weight: 600; color: #6b4e16; }
    .promo-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .promo-btn { text-decoration: none; display: inline-block; }
    .promo-qr { width: 120px; height: 120px; border-radius: 8px; background: #fff; padding: 6px; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .promo-note { margin-top: 6px; font-size: 12px; color: #7a6a4a; }
/* èƒŒæ™¯èˆ‡å…¶å½å…ƒç´ ä¸åƒäº‹ä»¶ï¼Œé¿å…å¶ç™¼æ“‹ä½æŒ‰éˆ• */
.bg, .bg::before, .bg::after { pointer-events: none; }
/* çµå°¾å€å¡Šçš„æ’ç‰ˆèˆ‡æ¨£å¼å¼·åŒ– */
.promo-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 720px) { .promo-row { grid-template-columns: 1fr 1fr; } }

.promo-item { display: flex; flex-direction: column; align-items: center; gap: 8px; }

.promo-caption {
  font-size: 12px; color: #7a6a4a;
  background: rgba(255,255,255,.7);
  padding: 4px 8px; border-radius: 8px;
}

/* QR æ”¹ç‚ºå¯é»æ“Šçš„å°å¡ç‰‡æ¨£å¼ï¼ˆèˆ‡è† å›ŠæŒ‰éˆ•åšå‡ºå€éš”ï¼‰ */
.promo-qr-link {
  display: inline-block;
  border: 1px dashed #e5d3b5;
  background: #fff;
  border-radius: 12px;
  padding: 6px;
  box-shadow: 0 2px 10px rgba(0,0,0,.06);
  transition: transform .2s ease, box-shadow .2s ease;
}
.promo-qr-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,.12);
}

/* QR ç¨å¾®æ”¾å¤§ï¼Œç•«é¢æ›´å¹³è¡¡ï¼ˆè¦†è“‹åŸ 120pxï¼‰ */
.promo-qr { width: 140px; height: 140px; }
/* çµæœæè¿°æ’ç‰ˆï¼ˆå­—å¤šæ™‚æ›´å¥½è®€ï¼‰ */
#resultDesc {
  font-size: 16px;
  line-height: 1.9;
}
@media (min-width: 720px) {
  #resultDesc { font-size: 17px; }
}

  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="wrap">
    <div class="header">
      <div class="brand">ğŸ½ ç¾é£Ÿæ€§æ ¼å°æ¸¬é©—</div>
      <div id="headerStep" class="progress-text">æº–å‚™é–‹å§‹</div>
    </div>

    <div class="progress"><span id="progressBar"></span></div>
    <div class="progress-text" id="progressText"></div>

    <section class="stage active" id="stage0">
      <div class="card hero">
        <h1>æ‰¾å‡ºä½ çš„ç¾é£Ÿæ€§æ ¼</h1>
        <p>8 é¡Œ Ã— ä¸‰é¸ä¸€ï¼Œç´„ 30 ç§’å®Œæˆã€‚ä¾†çœ‹çœ‹ä½ æ˜¯ç”šéº¼æ€§æ ¼çš„äººå§!!</p>
        <button class="btn-primary" id="startBtn">é–‹å§‹æ¸¬é©—</button>
      </div>
    </section>

    <section class="stage" id="stage1">
      <div class="grid">
        <div class="qcard">
          <h3>1. å¤©æ°£ç†±æœƒé¸æ“‡â€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q1" value="a"> a. æŒ«å†°</label>
            <label class="option"><input type="radio" name="q1" value="b"> b. éœœæ·‡æ·‹</label>
            <label class="option"><input type="radio" name="q1" value="c"> c. æ¶¼èŒ¶</label>
          </div>
        </div>
        <div class="qcard">
          <h3>2. æœ€ç„¡æ³•æ¥å—ä¸‹åˆ—ä½•è€…â€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q2" value="a"> a. è¦ç±³éœœæ·‡æ·‹</label>
            <label class="option"><input type="radio" name="q2" value="b"> b. é¦™èœé›ªç³•</label>
            <label class="option"><input type="radio" name="q2" value="c"> c. è±¬è¡€ç³•æ¯”è–©</label>
          </div>
        </div>
        <div class="qcard">
          <h3>3. ä¸»é£Ÿæ›´å–œæ­¡åƒâ€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q3" value="a"> a. é£¯</label>
            <label class="option"><input type="radio" name="q3" value="b"> b. éºµ</label>
            <label class="option"><input type="radio" name="q3" value="c"> c. éºµåŒ…é¡</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>è¿”å›</button>
        <div class="right">
          <button class="btn-primary" data-next>ä¸‹ä¸€é </button>
        </div>
      </div>
      <div class="status" id="status1"></div>
    </section>

    <section class="stage" id="stage2">
      <div class="grid">
        <div class="qcard">
          <h3>4. æ‹¿åˆ°é¤ç›’æœ€å…ˆåƒâ€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q4" value="a"> a. ç´…è±†éºµåŒ…</label>
            <label class="option"><input type="radio" name="q4" value="b"> b. è è˜¿éºµåŒ…</label>
            <label class="option"><input type="radio" name="q4" value="c"> c. è›‹ç³•æ²</label>
          </div>
        </div>
        <div class="qcard">
          <h3>5. å–œæ­¡å“ªç¨®æ–™ç†</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q5" value="a"> a. æ—¥å¼</label>
            <label class="option"><input type="radio" name="q5" value="b"> b. éŸ“å¼</label>
            <label class="option"><input type="radio" name="q5" value="c"> c. å°å¼</label>
          </div>
        </div>
        <div class="qcard">
          <h3>6. å–œæ­¡çš„é£Ÿç‰©æœƒâ€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q6" value="a"> a. ç¬¬ä¸€å£å…ˆåƒ</label>
            <label class="option"><input type="radio" name="q6" value="b"> b. ç•™åˆ°æœ€å¾Œå†åƒ</label>
            <label class="option"><input type="radio" name="q6" value="c"> c. æƒ³åƒå°±åƒä¸æœƒç®¡å¤ªå¤š</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>è¿”å›</button>
        <div class="right">
          <button class="btn-primary" data-next>ä¸‹ä¸€é </button>
        </div>
      </div>
      <div class="status" id="status2"></div>
    </section>

    <section class="stage" id="stage3">
      <div class="grid">
        <div class="qcard">
          <h3>7. åƒå’–å“©æœƒâ€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q7" value="a"> a. ä¸€å£é£¯ä¸€å£é†¬</label>
            <label class="option"><input type="radio" name="q7" value="b"> b. æš´åŠ›æ‹Œå‹»</label>
            <label class="option"><input type="radio" name="q7" value="c"> c. å…ˆåƒå®Œé†¬å†åƒé£¯</label>
          </div>
        </div>
        <div class="qcard">
          <h3>8. å–é£²æ–™æœƒé»â€¦</h3>
          <div class="opts">
            <label class="option"><input type="radio" name="q8" value="a"> a. å¾®ç³–</label>
            <label class="option"><input type="radio" name="q8" value="b"> b. åŠç³–</label>
            <label class="option"><input type="radio" name="q8" value="c"> c. å…¨ç³–</label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn-flat" data-back>è¿”å›</button>
        <div class="right">
          <button class="btn-primary" id="submitBtn">æäº¤ç­”æ¡ˆ</button>
        </div>
      </div>
      <div class="status" id="status3"></div>
    </section>

    <section class="stage" id="stageResult">
      <div class="card result-hero result-card result-a" id="resultCard">
        <div class="muted" id="resultCode">çµæœä»£ç¢¼ï¼šâ€”</div>
        <h2 id="resultTitle">ä½ çš„ç¾é£Ÿæ€§æ ¼æ˜¯ â€”â€” </h2>
        <p id="resultDesc" style="margin:8px 0 0;">å°‡åœ¨é€™è£¡é¡¯ç¤ºä½ çš„æè¿°ã€‚</p>
       <div class="promo">
  <p class="promo-text">æƒ³äº†è§£æ›´å¤šç¾é£Ÿè³‡è¨Šã€åŠ å…¥æˆ‘å€‘ç¤¾åœ˜ ğŸ‘‰</p>

  <div class="promo-row">
    <!-- A. è† å›ŠæŒ‰éˆ•ï¼ˆç¶­æŒä½ çš„ IG é€£çµï¼‰ -->
    <div class="promo-item">
      <a class="btn-primary promo-btn btn-instagram"
         href="https://www.instagram.com/ntnuckclub_?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="
         target="_blank" rel="noopener">
        å¸«å¤§ç¾é£Ÿç¤¾
      </a>
      <div class="promo-caption">ç¤¾åœ˜IGé€£çµ</div>
    </div>

    <!-- B. QR å¡ç‰‡ï¼šæ”¹ç‚ºé€£åˆ°è¿æ–°è¡¨å–® -->
<div class="promo-item">
  <a class="promo-qr-link"
     href="https://docs.google.com/forms/d/e/1FAIpQLSeSLpOJUDOHCWa3yhksq1W7AsSUxH_u8TckBC5CJKBM_H0v0w/viewform?usp=header"
     target="_blank" rel="noopener" aria-label="å‰å¾€è¿æ–°å ±åè¡¨å–®ï¼ˆGoogle è¡¨å–®ï¼‰">
    <img class="promo-qr" id="promoQR" alt="è¿æ–°è¡¨å–® QR Code"
         src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https%3A%2F%2Fdocs.google.com%2Fforms%2Fd%2Fe%2F1FAIpQLSeSLpOJUDOHCWa3yhksq1W7AsSUxH_u8TckBC5CJKBM_H0v0w%2Fviewform%3Fusp%3Dheader" />
  </a>
  <div class="promo-caption">9/9(äºŒ)è¿æ–°èŒ¶æœƒè¡¨å–®</div>
</div>
  </div>

  <div class="promo-note">é»æ“Šå³å¯é–‹å•Ÿç¤¾åœ˜ IGï¼Œæ­¡è¿è¿½è¹¤èˆ‡ç§è¨Šè©¢å•æ´»å‹•ï¼</div>
</div>

          <div class="promo-note">è¿æ–°èŒ¶æœƒ9/9(äºŒ)æ­¡è¿å¤§å®¶åŠ å…¥æˆ‘å€‘ä¸€èµ·ç©Ù©(Â´á—œ`*)à­¨</div>
        </div>
        <div class="actions" style="margin-top:14px;">
          <button class="btn-ghost" id="restartBtn">å†æ¸¬ä¸€æ¬¡</button>
        </div>
      </div>
    </section>

  </div>

  <script>
    const OPTION_SCORE = { a: 0, b: 1, c: 2 };
    const BUCKETS = [
      { max: 4,  code: 'A' },
      { max: 6, code: 'B' },
      { max: 8, code: 'C' },
      { max: 25, code: 'D' },
    ];
   const RESULT_TEXTS = {
  A: {
    title: 'A å‹ï¼šé¦™è‰å†°æ·‡æ·‹å°å¤©ä½¿',
    desc: 'åæ„›ç´”æ·¨èˆ‡æ¸…çˆ½çš„å£å‘³ï¼Œè¡Œäº‹ä¿è½é‡æ•ˆç‡ï¼›å¾…äººæº«æŸ”åˆå¯é ï¼Œé¡˜æ„ä¸»å‹•å”åŠ©èˆ‡å‚¾è½ï¼Œåƒæ·¡æ·¡é¦™è‰å¸¶ä¾†å®‰å®šèˆ‡å®‰å¿ƒæ„Ÿã€‚'
  },
  B: {
    title: 'B å‹ï¼šæ²™æ‹‰ç•ªèŒ„å°å·¥åŒ ',
    desc: 'è¬›ç©¶é…¸ç”œèˆ‡å£æ„Ÿçš„å¹³è¡¡ï¼Œå–œæ­¡å±¤æ¬¡æ¸…æ¥šçš„æ­é…ï¼›åšäº‹è€å¿ƒç´°ç·»ï¼Œé‡è¦–å”ä½œèˆ‡ç§©åºï¼Œé¡˜æ„èª¿å’Œä¸åŒæ„è¦‹ï¼Œè®“çµæœæ°åˆ°å¥½è™•ã€‚'
  },
  C: {
    title: 'C å‹ï¼šèŠ±èŒ¶è›‹ç³•å°å…¬ä¸»',
    desc: 'ç†±æ„›å„€å¼æ„Ÿèˆ‡ç´°ç¯€ï¼Œç¾æ„Ÿæ•éŠ³ï¼Œåå¥½ç´°ç·»å„ªé›…çš„é¢¨å‘³ï¼›æ“…æ–¼ç‡Ÿé€ æ°›åœèˆ‡ç¯€å¥ï¼ŒæŠŠæ—¥å¸¸æ‰“ç†æˆé¢¨æ™¯ï¼Œè®“äººæ„Ÿåˆ°æ”¾é¬†èˆ‡æ„‰æ‚…ã€‚'
  },
  D: {
    title: 'D å‹ï¼šç«è¾£è¾£æ¤’å°å†’éšªå®¶',
    desc: 'å‹‡æ–¼å˜—é®®ä¸è¨­é™ï¼Œé¢å°æ–°å¥‡ç¸½æ˜¯çœ¼ç›ç™¼äº®ï¼›è¡Œå‹•åŠ›å¼·ä¸”å¯Œå‰µæ„ï¼Œæ¨‚æ–¼æªåœ˜åˆ†äº«ï¼Œç¸½èƒ½æŠŠç†±è¾£èƒ½é‡åŒ–ä½œæ•…äº‹èˆ‡å›æ†¶ã€‚'
  }
};

// === å¾Œç«¯ç´€éŒ„è¨­å®šï¼ˆGoogle Apps Scriptï¼‰ ===
const ENABLE_LOGGING = true;
const LOG_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzEsbc1uIDRIEtmFfjH6_AP8fpNwW0KmpcBmnpjGuW3aR48CnYPovjUFCrTDalCilQ/exec';

function sendLog(payload){
  if (!ENABLE_LOGGING || !LOG_ENDPOINT) return;
  try {
    fetch(LOG_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      mode: 'no-cors',      // ä¸è®€å›æ‡‰ï¼Œæœ€ç©©å®š
      keepalive: true
    }).catch(()=>{});
  } catch(e){}
}

    

    const stages = ['stage0', 'stage1', 'stage2', 'stage3', 'stageResult'];
    let current = 0;

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function showStage(idx) {
      stages.forEach((id,i) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.toggle('active', i === idx);
      });
      current = idx;
      updateProgress();
      $$('.status').forEach(s => s.textContent = '');
    }

    function updateProgress(){
      const pb = $('#progressBar');
      const pt = $('#progressText');
      const hs = $('#headerStep');
      let step = 0, total = 3;
      if (current>=1 && current<=3) step = current;
      const percent = Math.round(step/total*100);
      pb.style.width = percent + '%';
      pt.textContent = step>0 ? `ç¬¬ ${step} / ${total} é ï¼ˆ${percent}%ï¼‰` : '';
      hs.textContent = step>0 ? `ç¬¬ ${step} / ${total} é ` : (current===4? 'å®Œæˆ' : 'æº–å‚™é–‹å§‹');
    }

    function validatePage(idx){
      const reqByStage = {
        1: ['q1','q2','q3'],
        2: ['q4','q5','q6'],
        3: ['q7','q8'],
      };
      const ids = reqByStage[idx] || [];
      let missing = [];
      ids.forEach(name => {
        const checked = $$(`input[name="${name}"]:checked`).length>0;
        if (!checked) missing.push(name);
      });
      if (missing.length){
        const statusEl = document.getElementById('status'+idx);
        const map = {q1:'ç¬¬1é¡Œ',q2:'ç¬¬2é¡Œ',q3:'ç¬¬3é¡Œ',q4:'ç¬¬4é¡Œ',q5:'ç¬¬5é¡Œ',q6:'ç¬¬6é¡Œ',q7:'ç¬¬7é¡Œ',q8:'ç¬¬8é¡Œ'};
        statusEl.textContent = 'è«‹å…ˆä½œç­”ï¼š' + missing.map(k=>map[k]).join('ã€');
        return false;
      }
      return true;
    }

    function computeResult(){
      let total = 0; const answers = {};
      for (let i=1;i<=8;i++){
        const el = $(`input[name="q${i}"]:checked`);
        if (!el) return { error: `ç¬¬ ${i} é¡Œå°šæœªä½œç­”` };
        const v = el.value; answers['q'+i] = v;
        total += OPTION_SCORE[v] ?? 0;
      }
      const bucket = BUCKETS.find(b => total <= b.max) || BUCKETS[BUCKETS.length-1];
      const def = RESULT_TEXTS[bucket.code] || { title:'æœªå®šç¾©', desc:'è«‹æª¢æŸ¥è¦å‰‡è¨­å®š' };
      return { total, code: bucket.code, title: def.title, desc: def.desc, answers };
    }

    function renderResult(r){
      const codeMap = {A:'result-a', B:'result-b', C:'result-c', D:'result-d'};
      document.getElementById('resultCode').textContent = `çµæœä»£ç¢¼ï¼š${r.code}ï¼ˆç¸½åˆ† ${r.total}ï¼‰`;
      document.getElementById('resultTitle').textContent = r.title;
      document.getElementById('resultDesc').textContent = r.desc;
      const box = document.getElementById('resultCard');
      ['result-a','result-b','result-c','result-d'].forEach(c=>box.classList.remove(c));
      if (codeMap[r.code]) box.classList.add(codeMap[r.code]);
    }

    document.getElementById('startBtn')?.addEventListener('click', () => showStage(1));

$$('[data-back]').forEach(btn => btn?.addEventListener('click', () => {
  if (current>1) showStage(current-1); else showStage(0);
}));

$$('[data-next]').forEach(btn => btn?.addEventListener('click', () => {
  if (!validatePage(current)) return;
  if (current<3) showStage(current+1);
}));


    document.getElementById('submitBtn').addEventListener('click', () => {
      if (!validatePage(3)) return;
      const r = computeResult();
      if (r.error){ document.getElementById('status3').textContent = r.error; return; }
      renderResult(r);
      sendLog({
  timestamp: new Date().toISOString(),
  answers: r.answers,
  total: r.total,
  code: r.code,
  title: r.title,
  desc: r.desc,
  userAgent: navigator.userAgent,
  referrer: document.referrer || ''
});

      showStage(4);
    });

    document.getElementById('restartBtn').addEventListener('click', () => {
      for (let i=1;i<=8;i++){ const el = $$(`input[name="q${i}"]`); el.forEach(x=>x.checked=false); }
      showStage(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    updateProgress();
  </script>
</body>
</html>
```